var upsell1notification = {
        1: {
            time:"47 min. ago",
            content:'<b>Ariella Thomas </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Gagliano Castelferrato, Italy</strong> just purchased 180 Day Supply of Breathe P.M.'
        },        
        2: {
            time:"53 min. ago",
            content:'<b>August Perkins </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Marion, United States</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        3: {
            time:"9 min. ago",
            content:'<b>Matthew Moore </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Ponderosa Pine, United States</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        4: {
            time:"15 min. ago",
            content:'<b>Mary Gross </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Polzeath, United Kingdom</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        5: {
            time:"1 min. ago",
            content:'<b>Greyson Patel </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Hillerod, Denmark</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        6: {
            time:"4 min. ago",
            content:'<b>Mateo Cruz </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Amzacea, Romania</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        7: {
            time:"33 min. ago",
            content:'<b>Ella Miller </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Castle Bruce, Dominica</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        8: {
            time:"1 hour ago",
            content:' <b>Avery Briggs </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Winterport, United States</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        9: {
            time:"11 min. ago",
            content:'<b>Isabelle Ward </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Gdansk, Poland</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        10: {
            time:"22 min. ago",
            content:'<b>Isabelle Ward </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Mehna, Germany</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        11: {
            time:"15 min. ago",
            content:'<b>June Young </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Myrtletown, United States</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        12: {
            time:"8 min. ago",
            content:'<b>Anthony Cook </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Union Springs, United States</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        13: {
            time:"2 days. ago",
            content:'<b>Sage Castillo </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Agullent, Spain</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        14: {
            time:"59 min. ago",
            content:'<b>Ximena Howard </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Caparica, Portugal</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        15: {
            time:"25 min. ago",
            content:'<b>Maximus Wilson </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Kargow, Germany</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        16: {
            time:"29 min. ago",
            content:'<b>Juliette Cook </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Napkor, Hungary</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        17: {
            time:"19 min. ago",
            content:'<b>Victor James </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Farnese, Italy</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        18: {
            time:"32 min. ago",
            content:'<b>Matteo Gutierrez </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Cristesti, Romania</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        19: {
            time:"32 min. ago",
            content:'<b>Khloe Hale </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Bayshint, Mongolia</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        20: {
            time:"8 min. ago",
            content:'<b>Henry Patel </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Ottobrunn. Germany</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        21: {
            time:"56 min. ago",
            content:'<b>Brandon Norris </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Cottage Grove, United States</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        22: {
            time:"4 min. ago",
            content:'<b>Lucy Gill </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Amzacea, Romania</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        23: {
            time:"37 min. ago",
            content:'<b>Francisco Campbell </b> from<strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Edmonds, United States</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        24: {
            time:"9 min. ago",
            content:'<b>Summer James </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Juzcar, Spain</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        25: {
            time:"54 min. ago",
            content:'<b>Charlee Parson </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Andrews, United States</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        26: {
            time:"52 min. ago",
            content:'<b>Eloise Cruz </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Tyup, Kyrgyzstan</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
        27: {
            time:"31 min. ago",
            content:' <b>Ivy Fuller </b> from <strong class="saleverify-highlight" style="color: rgb(16, 94, 251)">Benecko, Czech Republic</strong> just purchased 180 Day Supply of Breathe P.M.'
        },
};

  function upsell1ShowNotification(key) {
      $('.shuffle_min').html(upsell1notification[key].time);
      $('.shuffle_content').html(upsell1notification[key].content);
      $('.shuffle_div').fadeIn();
      setTimeout(function() {
          $('.shuffle_div').fadeOut();
      }, 5000);
  }
  function upsell1DisplayNotifications() {
      var keys = Object.keys(upsell1notification);
      var index = 0;
      upsell1ShowNotification(keys[index]);
    setInterval(function() {
        index++;
        if (index >= keys.length) {
            index = 0;
        }
        upsell1ShowNotification(keys[index]);
    }, 10000);
  }


$(document).ready(function () {
  var targetModal;

  $('a[data-toggle="modal"]').on("click touchstart", function (e) {
    e.preventDefault();
    targetModal = $($(this).data("target"));

    // Show the modal
    targetModal.modal("show");

    targetModal.modal({
      backdrop: "static",
      keyboard: false,
    });

    // Update display to flex
    targetModal.on("shown.bs.modal", function () {
      targetModal.css("display", "flex");
    });

    $("#fullscreenModal").on("hide.bs.modal", function (e) {
      e.preventDefault();
      e.stopPropagation();
      return false;
    });
  });
});

/******************
 * STOPWATCH CLASS
 *****************/

function Stopwatch(config) {
  // If no config is passed, create an empty set
  config = config || {};
  // Set the options (passed or default)
  this.element = config.element || {};
  this.previousTime = config.previousTime || new Date().getTime();
  this.paused = config.paused && true;
  this.elapsed = config.elapsed || 0;
  this.countingUp = config.countingUp && true;
  this.timeLimit = config.timeLimit || (this.countingUp ? 60 * 10 : 0);
  this.updateRate = config.updateRate || 100;
  this.onTimeUp =
    config.onTimeUp ||
    function () {
      this.stop();
    };
  this.onTimeUpdate =
    config.onTimeUpdate ||
    function () {
      //console.log(this.elapsed);
    };
  if (!this.paused) {
    this.start();
  }
}

Stopwatch.prototype.start = function () {
  // Unlock the timer
  this.paused = false;
  // Update the current time
  this.previousTime = new Date().getTime();
  // Launch the counter
  this.keepCounting();
};

Stopwatch.prototype.keepCounting = function () {
  // Lock the timer if paused
  if (this.paused) {
    return true;
  }
  // Get the current time
  var now = new Date().getTime();
  // Calculate the time difference from last check and add/substract it to 'elapsed'
  var diff = now - this.previousTime;
  if (!this.countingUp) {
    diff = -diff;
  }
  this.elapsed = this.elapsed + diff;
  // Update the time
  this.previousTime = now;
  // Execute the callback for the update
  this.onTimeUpdate();
  // If we hit the time limit, stop and execute the callback for time up
  if (
    (this.elapsed >= this.timeLimit && this.countingUp) ||
    (this.elapsed <= this.timeLimit && !this.countingUp)
  ) {
    this.stop();
    this.onTimeUp();
    return true;
  }
  // Execute that again in 'updateRate' milliseconds
  var that = this;
  setTimeout(function () {
    that.keepCounting();
  }, this.updateRate);
};

Stopwatch.prototype.stop = function () {
  // Change the status
  this.paused = true;
};

/******************
 * COUNTDOWN CLASS
 *****************/

function countdown(element, paused, elapsed) {
  var stopwatch = new Stopwatch({
    element: element, // DOM element
    paused: paused, // Status
    elapsed: elapsed, // Current time in milliseconds
    countingUp: false, // Counting up or down
    timeLimit: 0, // Time limit in milliseconds
    updateRate: 100, // Update rate, in milliseconds
    onTimeUp: function () {
      // onTimeUp callback
      this.stop();
      $(this.element).html("00:00");
    },
    onTimeUpdate: function () {
      // onTimeUpdate callback
      var t = this.elapsed,
        h = ("0" + Math.floor(t / 3600000)).slice(-2),
        m = ("0" + Math.floor((t % 3600000) / 60000)).slice(-2),
        s = ("0" + Math.floor((t % 60000) / 1000)).slice(-2);
      var formattedTime = m + ":" + s;
      $(this.element).html(formattedTime);
    },
  });
}
var elsHiddenList = [];
var alreadyDisplayedKey = `alreadyElsDisplayed${SECONDS_TO_DISPLAY}`;
var showHiddenElements = function () {
  //console.log(smartplayer.instances);
  elsDisplayed = true;
  elsHiddenList.forEach((e) => (e.style.display = "block"));
  localStorage.setItem(alreadyDisplayedKey, true);
  var counter = document.getElementById("countdown1");
  var counter2 = document.getElementById("countdown2");
  var counter3 = document.getElementById("countdown3");
  var counter4 = document.getElementById("countdown4");

  countdown(counter, false, 900000);
  countdown(counter2, false, 900000);
  countdown(counter3, false, 900000);
  countdown(counter4, false, 900000);
};

document.getElementById("showsectiononrefresh").style.display = "none";
var checkVisit = localStorage.getItem("sectionShown2");

var counter = document.getElementById("countdown1");
var counter2 = document.getElementById("countdown2");
var counter3 = document.getElementById("countdown3");
var counter4 = document.getElementById("countdown4");
var SECONDS_TO_DISPLAY = 420;

var startupsell1WatchVideoProgress = function () {
  console.log("Function Started");
  smartplayer.instances.forEach(function (instance) {
    instance.on("play", () => {
      console.log("Video is playing");
    });

    instance.on("pause", () => {
      console.log("Video is paused");
    });

    instance.on("timeupdate", () => {
      if (
        instance.analytics.player.options.id == "66ac9b5f4d13fe000ba7bb54" // Desktop video ID
      ) {
        SECONDS_TO_DISPLAY = 420;
      } else if (
        instance.analytics.player.options.id == "65a013cf0922ed00090f3027" // Mobile video ID
      ) {
        SECONDS_TO_DISPLAY = 377;
      }

      if (
        !instance.video.paused &&
        instance.video.currentTime >= SECONDS_TO_DISPLAY
      ) {
        if (checkVisit == null) {
          checkVisit = true;
          console.log("Show Contents");
          localStorage.setItem("sectionShown2", true);
          contentsDisplayed = true;
          checkVisit = localStorage.getItem("sectionShown2");
          document.getElementById("showsectiononrefresh").style.display =
            "block";
          document.getElementById("shuffle").style.display = "block";
          setTimeout(function () {
            console.log("Watched Video");
            var counter = document.getElementById("countdown1");
            var counter2 = document.getElementById("countdown2");
            var counter3 = document.getElementById("countdown3");
            var counter4 = document.getElementById("countdown4");
            countdown(counter, false, 900000);
            countdown(counter2, false, 900000);
            countdown(counter3, false, 900000);
            countdown(counter4, false, 900000);
            var visitCounterer = localStorage.getItem("visits");
            if (visitCounterer > 1) {
                upsell1DisplayNotifications();
            }
          }, 1000);
        }
      }
    });
  });
};

 function checkSmartPlayer() {
   if (typeof smartplayer !== 'undefined') {
       startupsell1WatchVideoProgress();
       console.log('smartPlayer object found:', smartplayer);
   } else {
       console.log('smartPlayer object not found. Checking again in 1 second...');
       setTimeout(checkSmartPlayer, 1000);
   }
 }

 // Call the function to start checking for smartPlayer
 checkSmartPlayer();

document.addEventListener("DOMContentLoaded", function () {
  var attempts = 0;
  var visited = Number(localStorage.getItem("visits")) || 0;
  var alreadyVisited = visited >= 1;
  localStorage.setItem("visits", visited + 1);
  var attempts = 0;
  var alreadyElsDisplayed = localStorage.getItem(alreadyDisplayedKey);

  var watchEvents = function () {
    if (
      typeof smartplayer === "undefined" ||
      !(smartplayer.instances && smartplayer.instances.length)
    ) {
      if (attempts >= 10) return;
      attempts += 1;
      return setTimeout(function () {
        watchEvents();
      }, 1000);
    }

    let videoWrapper = document.querySelectorAll(".video-wrapper");
    let background = document.querySelectorAll(".backgroundBlack");
    let video = document.querySelector("#smartplayer");
    let videoPlayer = document.querySelector(".smartplayer-video");
    let smartplayVideo = document.querySelectorAll(".smartplay");

    video.style.padding = "56% 0 0";
    videoWrapper[1].style.width = "100%";

    for (let instance of smartplayer.instances) {
      instance.on("play", () => {
        for (let wrapper of videoWrapper) {
          wrapper.style.position = "absolute";
          wrapper.style.width = "100%";
          wrapper.style.height = "100vh";
          wrapper.style.maxHeight = "100vh";
          wrapper.style.maxWidth = "100vw";
          wrapper.style.top = 0;
          wrapper.style.left = 0;
        }
        for (let bg of background) {
          bg.style.maxWidth = "100vw";
          bg.style.height = "100vh";
          bg.style.maxHeight = "100vh";
          bg.style.background = "black";
        }
        jQuery("#video-mobile > div").css("padding-left", "0px");
        jQuery("#video-mobile > div").css("padding-right", "0px");
        jQuery("#video-mobile").css("padding-top", "0px");
        // jQuery("#video-mobile").css("height", "100vh");
        jQuery("#video-mobile > div > div > div > div > div").css(
          "height",
          "100vh"
        );
        jQuery("#video-desktop > div > div > h1").css("display", "none");
        jQuery("#video-desktop > div > div > h2").css("display", "none");
        jQuery("#video-desktop > div > div > h3").css("display", "none");
        jQuery("#shuffle").css("display", "none");
        window.scrollTo(0, 0);
        video.style.height = "100vh";
        video.style.maxHeight = "100vh";
        video.style.padding = window.innerWidth < 700 ? "148% 0 0" : "0";
        smartplayVideo[1].style.padding = "148% 0 0";
        document.body.style.marginTop =
          window.innerWidth < 700 ? "100vh" : "100vh";
      });

      // Cancel fullscreen when paused
      instance.on("pause", () => {
        for (let wrapper of videoWrapper) {
          wrapper.style.position = "relative";
          wrapper.style.width = "100%";
          wrapper.style.height = "100%";
          wrapper.style.maxHeight = "auto";
        }
        for (let bg of background) {
          bg.style.maxWidth = "902px";
          bg.style.position = "relative";
          bg.style.height = "510px";
          bg.style.maxHeight = "none";
          bg.style.background = "none";
        }

        video.style.height = "100%";
        video.style.maxHeight = "none";
        video.style.padding = "0";
        document.body.style.marginTop = "0";
        jQuery("#video-mobile > div").css("padding-left", "15px");
        jQuery("#video-mobile > div").css("padding-right", "15px");
        jQuery("#video-mobile").css("padding-top", "20px");
        jQuery("#video-mobile").css("height", "auto");
        jQuery("#video-mobile > div > div > div > div > div").css(
          "height",
          "auto"
        );
        jQuery("#video-desktop > div > div > h1").css("display", "block");
        jQuery("#video-desktop > div > div > h2").css("display", "block");
        jQuery("#video-desktop > div > div > h3").css("display", "block");
      });
    }
  };
  watchEvents();
});

if (checkVisit == "false") {
  document.getElementById("showsectiononrefresh").style.display = "none";
  document.getElementById("shuffle").style.display = "none";
  console.log("Have Not Watched the Video");
}
if (checkVisit == null) {
  document.getElementById("showsectiononrefresh").style.display = "none";
  document.getElementById("shuffle").style.display = "none";
  console.log("Initial Visit");
}
if (checkVisit === "true") {
  document.getElementById("showsectiononrefresh").style.display = "block";
  document.getElementById("shuffle").style.display = "block";
  setTimeout(function () {
    console.log("Watched Video");
    var counter = document.getElementById("countdown1");
    var counter2 = document.getElementById("countdown2");
    var counter3 = document.getElementById("countdown3");
    var counter4 = document.getElementById("countdown4");
    countdown(counter, false, 900000);
    countdown(counter2, false, 900000);
    countdown(counter3, false, 900000);
    countdown(counter4, false, 900000);
    var visitCounterer = localStorage.getItem("visits");
    if (visitCounterer > 1) {
      console.log("-------------------");
      upsell1DisplayNotifications();
    }
  }, 1000);
}
